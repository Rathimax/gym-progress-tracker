<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description"
    content="FitTrack Gym Tracker helps you log workouts, track progress, and manage personal fitness data.">
  <meta name="theme-color" content="#c6ffdd">

  <!-- PWA MANIFEST -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="https://i.pinimg.com/736x/da/90/9a/da909a8e5bbacd83c82222006ebf7321.jpg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <title>FitTrack Gym Tracker</title>

  <link rel="icon" type="image/jpeg" href="https://i.pinimg.com/736x/da/90/9a/da909a8e5bbacd83c82222006ebf7321.jpg">
  <link
    href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Outfit:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&display=swap"
    rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet" />
  <link rel="stylesheet" href="style.css?v=15">
</head>

<body>

  <!-- Custom Gym Loading Screen -->
  <div class="loader-wrapper" id="loader">
    <div class="loader-content">
      <!-- Gym Equipment Animation Container -->
      <div class="equipment-container">
        <!-- Dumbbell (Phase 1) -->
        <div class="dumbbell active">
          <div class="dumbbell-weight left"></div>
          <div class="dumbbell-bar"></div>
          <div class="dumbbell-weight right"></div>
        </div>

        <!-- Barbell (Phase 2) -->
        <div class="barbell">
          <div class="barbell-plate left outer"></div>
          <div class="barbell-plate left inner"></div>
          <div class="barbell-bar"></div>
          <div class="barbell-plate right inner"></div>
          <div class="barbell-plate right outer"></div>
        </div>

        <!-- Kettlebell (Phase 3) -->
        <div class="kettlebell">
          <div class="kettlebell-handle"></div>
          <div class="kettlebell-body"></div>
        </div>
      </div>

      <!-- Wavy Loading Bar -->
      <div class="wavy-loader">
        <div class="wave-container">
          <div class="wave wave1"></div>
          <div class="wave wave2"></div>
          <div class="wave wave3"></div>
        </div>
        <div class="loader-progress"></div>
      </div>

      <!-- Loading Text -->
      <div class="loader-text">
        <span class="loading-word">Loading</span>
        <span class="dot dot1">.</span>
        <span class="dot dot2">.</span>
        <span class="dot dot3">.</span>
      </div>
    </div>
  </div>
  <div id="notification" class="notification" role="alert" aria-live="polite"></div>

  <!-- AUTH MODAL -->
  <div id="auth-modal" class="modal" style="display:flex; z-index: 20000;">
    <div class="modal-content" style="max-width: 400px; text-align: center;">
      <h2 id="auth-title" style="margin-bottom: 1rem;">Welcome to FitTrack</h2>
      <p style="color: var(--text-light); margin-bottom: 2rem;">Sign in to save your progress correctly.</p>

      <button id="btn-google-login" class="btn-primary"
        style="background: white; color: #333; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 1.5rem; width: 100%;">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" height="20">
        Sign in with Google
      </button>

      <div class="divider"
        style="display: flex; align-items: center; margin: 1.5rem 0; color: var(--text-light); font-size: 0.8rem;">
        <span style="flex: 1; height: 1px; background: var(--card-border);"></span>
        <span style="padding: 0 10px;">OR</span>
        <span style="flex: 1; height: 1px; background: var(--card-border);"></span>
      </div>

      <form id="auth-form" style="display: flex; flex-direction: column; gap: 1rem;">
        <input type="email" id="auth-email" placeholder="Email Address" required
          style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid var(--card-border); background: var(--input-bg); color: var(--text);">
        <input type="password" id="auth-password" placeholder="Password" required
          style="width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid var(--card-border); background: var(--input-bg); color: var(--text);">
        <button type="submit" id="btn-auth-submit" class="btn-primary" style="width: 100%;">Sign In</button>
      </form>

      <p style="margin-top: 1.5rem; font-size: 0.9rem; color: var(--text-light);">
        <span id="auth-switch-text">Don't have an account?</span>
        <a href="#" id="auth-switch-btn" style="color: var(--accent-end); font-weight: 600; text-decoration: none;">Sign
          Up</a>
      </p>
    </div>
  </div>

  <!-- Mobile Navigation Overlay (Removed) -->

  <!-- Sidebar -->
  <!-- RESTYLE: Permanent Sidebar / Bottom Nav -->
  <nav id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <h2>FitTrack</h2>
    </div>
    <ul class="nav-links">
      <li class="nav-item active" data-target="view-home"><span class="icon"><i class="ri-home-4-line"></i></span> <span
          class="label">Home</span>
      </li>
      <li class="nav-item" data-target="view-ai"><span class="icon"><i class="ri-robot-2-fill"></i></span> <span
          class="label">AI Assistant</span></li>
      <li class="nav-item" data-target="view-history"><span class="icon"><i class="ri-calendar-todo-line"></i></span>
        <span class="label">History</span>
      </li>
      <li class="nav-item" data-target="view-achievements"><span class="icon"><i class="ri-trophy-line"></i></span>
        <span class="label">Awards</span>
      </li>
      <li class="nav-item" data-target="view-tools"><span class="icon"><i class="ri-tools-line"></i></span> <span
          class="label">Tools</span></li>
      <li class="nav-item" data-target="view-settings"><span class="icon"><i class="ri-settings-4-line"></i></span>
        <span class="label">Settings</span>
      </li>
    </ul>
  </nav>

  <!-- Header -->
  <header>
    <div class="header-left">
      <h1><span class="app-icon"><img src="https://i.pinimg.com/736x/da/90/9a/da909a8e5bbacd83c82222006ebf7321.jpg"
            alt="Icon" style="height: 30px; width: 30px; object-fit: cover; border-radius: 8px;" /></span> FitTrack</h1>
    </div>
    <div class="header-right" id="header-profile" style="display:flex; align-items:center; gap:0.5rem; cursor:pointer;">
      <!-- Profile injected by JS -->
      <div class="profile-pic" style="width:35px; height:35px; border-radius:50%; background:#ddd; overflow:hidden;">
        <img class="header-avatar" src="https://i.pinimg.com/736x/da/90/9a/da909a8e5bbacd83c82222006ebf7321.jpg"
          style="width:100%; height:100%; object-fit:cover;">
      </div>
    </div>
  </header>

  <div class="container">

    <!-- VIEW 1: HOME -->
    <div id="view-home" class="view-section active-view">

      <!-- Active Routine Widget -->
      <div id="routine-widget" class="card card-compact hidden"
        style="margin-bottom:2rem; border:2px solid var(--accent-start); background:#FBF9FF;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
          <h3 style="margin:0; font-size:1.1rem; color:var(--accent-end);"><i class="ri-flashlight-fill"></i> Active
            Routine</h3>
          <button id="btn-quit-routine"
            style="width:auto; padding:0.4rem 0.8rem; background:transparent; color:var(--text-light); border:1px solid var(--card-border); border-radius:12px; font-size:0.8rem;">Exit</button>
        </div>
        <div style="margin-bottom:0.8rem; font-weight:700; font-size:1.2rem;" id="active-routine-name">--</div>
        <div id="routine-checklist" class="checklist-grid"></div>
      </div>


      <!-- Log Workout -->
      <div class="card card-log-workout">
        <div
          style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; border-bottom:2px solid var(--card-border); padding-bottom:0.75rem;">
          <h2 style="border:none; margin:0; padding:0;"><span class="icon"><i class="ri-edit-circle-fill"></i></span>
            Log Workout</h2>
          <button id="btn-open-routines"
            style="width:auto; padding:0.5rem 1rem; font-size:0.85rem; background:var(--input-bg); color:var(--accent-end); border-radius:20px; box-shadow:none; border:1px solid var(--card-border); display:flex; align-items:center; gap:6px;">
            <span><i class="ri-folder-open-fill"></i></span> Load Routine
          </button>
        </div>
        <form id="workout-form">
          <label for="exercise-select">Exercise:</label>
          <div class="exercise-input-wrapper">
            <select id="exercise-select" required>
              <option value="">Select an exercise</option>

              <!-- CHEST -->
              <optgroup label="Chest">
                <option>Bench Press (Barbell)</option>
                <option>Bench Press (Dumbbell)</option>
                <option>Bench Press (Smith Machine)</option>
                <option>Incline Bench Press (Barbell)</option>
                <option>Incline Bench Press (Dumbbell)</option>
                <option>Incline Bench Press (Smith Machine)</option>
                <option>Decline Bench Press</option>
                <option>Chest Press (Machine)</option>
                <option>Push Up</option>
                <option>Weighted Push Up</option>
                <option>Chest Fly (Dumbbell)</option>
                <option>Chest Fly (Cable)</option>
                <option>Pec Deck / Machine Fly</option>
                <option>Dips (Chest Focus)</option>
                <option>Pullover (Dumbbell)</option>
                <option>Svend Press</option>
                <option>Landmine Press</option>
                <option>Floor Press</option>
              </optgroup>

              <!-- BACK -->
              <optgroup label="Back">
                <option>Deadlift (Conventional)</option>
                <option>Deadlift (Sumo)</option>
                <option>Deadlift (Romania)</option>
                <option>Rack Pull</option>
                <option>Pull Up</option>
                <option>Weighted Pull Up</option>
                <option>Chin Up</option>
                <option>Weighted Chin Up</option>
                <option>Lat Pulldown (Wide Grip)</option>
                <option>Lat Pulldown (Close Grip)</option>
                <option>Lat Pulldown (Reverse Grip)</option>
                <option>Barbell Row</option>
                <option>Pendlay Row</option>
                <option>Dumbbell Row (Single Arm)</option>
                <option>Seated Cable Row</option>
                <option>T-Bar Row</option>
                <option>Chest Supported Row</option>
                <option>Face Pull</option>
                <option>Shrugs (Barbell)</option>
                <option>Shrugs (Dumbbell)</option>
                <option>Back Extension / Hyperextension</option>
                <option>Good Morning</option>
              </optgroup>

              <!-- SHOULDERS -->
              <optgroup label="Shoulder">
                <option>Overhead Press (Barbell)</option>
                <option>Overhead Press (Dumbbell)</option>
                <option>Seated Shoulder Press (Dumbbell)</option>
                <option>Seated Shoulder Press (Machine)</option>
                <option>Arnold Press</option>
                <option>Push Press</option>
                <option>Lateral Raise (Dumbbell)</option>
                <option>Lateral Raise (Cable)</option>
                <option>Lateral Raise (Machine)</option>
                <option>Front Raise (Dumbbell)</option>
                <option>Front Raise (Cable)</option>
                <option>Front Raise (Plate)</option>
                <option>Rear Delt Fly (Dumbbell)</option>
                <option>Rear Delt Fly (Machine)</option>
                <option>Rear Delt Fly (Cable)</option>
                <option>Upright Row</option>
                <option>Egyptian Lateral Raise</option>
              </optgroup>

              <!-- LEGS (QUADS) -->
              <optgroup label="Legs - Quads">
                <option>Squat (Barbell Back)</option>
                <option>Squat (Barbell Front)</option>
                <option>Squat (Goblet)</option>
                <option>Leg Press</option>
                <option>Hack Squat</option>
                <option>Leg Extension</option>
                <option>Lunge (Walking)</option>
                <option>Lunge (Reverse)</option>
                <option>Split Squat (Bulgarian)</option>
                <option>Split Squat (Static)</option>
                <option>Step Up</option>
                <option>Sissy Squat</option>
                <option>Pistol Squat</option>
              </optgroup>

              <!-- LEGS (HAMSTRINGS & GLUTES) -->
              <optgroup label="Legs - Hams & Glutes">
                <option>Romanian Deadlift (Barbell)</option>
                <option>Romanian Deadlift (Dumbbell)</option>
                <option>Leg Curl (Seated)</option>
                <option>Leg Curl (Lying)</option>
                <option>Nordic Hamstring Curl</option>
                <option>Hip Thrust (Barbell)</option>
                <option>Hip Thrust (Machine)</option>
                <option>Glute Bridge</option>
                <option>Cable Kickback</option>
                <option>Glute Ham Raise</option>
                <option>Hip Abduction (Machine)</option>
                <option>Hip Adduction (Machine)</option>
              </optgroup>

              <!-- CALVES -->
              <optgroup label="Calves">
                <option>Calf Raise (Standing)</option>
                <option>Calf Raise (Seated)</option>
                <option>Calf Raise (Leg Press)</option>
                <option>Donkey Calf Raise</option>
              </optgroup>

              <!-- BICEPS -->
              <optgroup label="Bicep">
                <option>Bicep Curl (Barbell)</option>
                <option>Bicep Curl (Dumbbell)</option>
                <option>Hammer Curl</option>
                <option>Preacher Curl (Barbell)</option>
                <option>Preacher Curl (Machine)</option>
                <option>Concentration Curl</option>
                <option>Cable Curl</option>
                <option>Bayesian Curl</option>
                <option>Spider Curl</option>
                <option>Reverse Curl</option>
                <option>Zottman Curl</option>
                <option>Incline Dumbbell Curl</option>
                <option>Strict Curl</option>
              </optgroup>

              <!-- TRICEPS -->
              <optgroup label="Tricep">
                <option>Tricep Pushdown (Rope)</option>
                <option>Tricep Pushdown (Bar)</option>
                <option>Skull Crushers (Barbell)</option>
                <option>Skull Crushers (Dumbbell)</option>
                <option>Overhead Tricep Extension (Dumbbell)</option>
                <option>Overhead Tricep Extension (Cable)</option>
                <option>Close Grip Bench Press</option>
                <option>Dips (Tricep Focus)</option>
                <option>Kickback (Dumbbell)</option>
                <option>Kickback (Cable)</option>
                <option>JM Press</option>
              </optgroup>

              <!-- ABS / CORE -->
              <optgroup label="Abs & Core">
                <option>Plank</option>
                <option>Side Plank</option>
                <option>Crunch</option>
                <option>Sit Up</option>
                <option>Leg Raise (Hanging)</option>
                <option>Leg Raise (Lying)</option>
                <option>Captain's Chair Leg Raise</option>
                <option>Russian Twist</option>
                <option>Cable Crunch</option>
                <option>Ab Wheel Rollout</option>
                <option>Woodchopper</option>
                <option>Vacuum</option>
                <option>L-Sit</option>
              </optgroup>

              <!-- CARDIO & PLYO -->
              <optgroup label="Cardio & Plyo">
                <option>Running (Treadmill)</option>
                <option>Running (Outdoor)</option>
                <option>Cycling</option>
                <option>Rowing Machine</option>
                <option>Jump Rope</option>
                <option>Box Jump</option>
                <option>Burpees</option>
                <option>Mountain Climbers</option>
                <option>Jumping Jacks</option>
                <option>Battle Ropes</option>
              </optgroup>

              <!-- OLYMPIC & FULL BODY -->
              <optgroup label="Olympic & Full Body">
                <option>Clean and Jerk</option>
                <option>Snatch</option>
                <option>Power Clean</option>
                <option>Hang Clean</option>
                <option>Thruster</option>
                <option>Kettlebell Swing</option>
                <option>Turkish Get Up</option>
                <option>Farmers Walk</option>
              </optgroup>

              <!-- OTHER -->
              <optgroup label="Other">
                <option>Neck Curl</option>
                <option>Neck Extension</option>
                <option>Wrist Curl</option>
                <option>Wrist Extension</option>
              </optgroup>
            </select>
            <input type="text" id="exercise-text" class="hidden" placeholder="Type custom exercise..." />
            <button type="button" id="toggle-input-btn" title="Type custom exercise"><i
                class="ri-add-line"></i></button>
          </div>

          <label for="reps">Reps:</label><input type="number" id="reps" step="1" required placeholder="e.g., 10" />
          <label for="sets">Sets:</label><input type="number" id="sets" step="1" required placeholder="e.g., 3" />
          <label for="weight">Weight (kg):</label><input type="number" id="weight" step="0.1" required
            placeholder="e.g., 20.5" />

          <div id="rm-display" class="rm-display hidden">Est. 1RM: <span>0</span> kg</div>

          <label for="duration">Estimated Duration:</label>
          <div class="duration-input"><input type="number" id="duration-minutes" step="1" min="0" max="59"
              placeholder="Mins" /><input type="number" id="duration-seconds" step="1" min="0" max="59"
              placeholder="Secs" /></div>

          <button type="submit">Add Workout</button>
        </form>
      </div>

      <!-- Body Weight -->
      <div class="card card-compact">
        <h2><span class="icon"><i class="ri-scales-3-fill"></i></span> Body Weight Tracker</h2>
        <form id="bw-form" class="inline-form">
          <input type="number" id="bw-input" step="0.1" placeholder="Current Weight (kg)" required />
          <input type="date" id="bw-date" required />
          <button type="submit">Log Weight</button>
        </form>
        <div class="bw-stats">
          <span>Latest: <strong id="bw-current">--</strong></span>
          <span>Start: <strong id="bw-start">--</strong></span>
          <span>Change: <strong id="bw-change">--</strong></span>
        </div>
      </div>
    </div>

    <!-- VIEW 2: AI ASSISTANT -->
    <div id="view-ai" class="view-section">
      <div class="card card-wide" style="height: 70vh; display: flex; flex-direction: column;">
        <h2><span class="icon"><i class="ri-sparkling-fill"></i></span><span>F<em>AI</em>T</span></h2>
        <div id="ai-chat-messages"
          style="flex: 1; overflow-y: auto; padding: 1rem; display: flex; flex-direction: column; gap: 1rem; border-radius: 12px; background: rgba(0,0,0,0.02)">
          <div class="ai-message bot"
            style="align-self: flex-start; background: var(--input-bg); padding: 1rem; border-radius: 12px; max-width: 80%; line-height: 1.5;">
            Hello! I'm your FitTrack AI. I can analyze your workout history, suggest routines, and answer gym-related
            questions. How can I help?
          </div>
        </div>
        <div class="ai-input-area"
          style="display: flex; gap: 0.5rem; margin-top: 1rem; border-top: 1px solid var(--card-border); padding-top: 1rem;">
          <input type="text" id="ai-chat-input" placeholder="Ask about your progress or workouts..."
            style="flex: 1; padding: 0.8rem; border-radius: 8px; border: 1px solid var(--card-border); background: var(--input-bg); color: var(--text);" />
          <button id="ai-chat-send"
            style="width: auto; padding: 0.8rem 1.2rem; background: var(--accent-gradient); color: white; border-radius: 8px; border: none; cursor: pointer;"><i
              class="ri-send-plane-fill"></i></button>
        </div>
      </div>
    </div>

    <!-- VIEW 3: HISTORY -->
    <div id="view-history" class="view-section">
      <div class="card card-wide">
        <h2><span class="icon"><i class="ri-history-line"></i></span> Workout History</h2>
        <div id="history-controls"></div>
        <div id="history-list"></div>
      </div>
    </div>

    <!-- VIEW 6: ACHIEVEMENTS -->
    <div id="view-achievements" class="view-section">
      <div class="card card-wide">
        <h2><span class="icon"><i class="ri-medal-fill"></i></span> Trophy Case</h2>
        <div style="margin-bottom:1.5rem; text-align:center;">
          <div id="achievements-progress"
            style="font-size:1.2rem; font-weight:700; color:var(--accent-end); margin-bottom:0.5rem;">0 / 0 Unlocked
          </div>
          <div class="progress-bar-bg"
            style="width:100%; height:8px; background:var(--input-bg); border-radius:10px; overflow:hidden;">
            <div id="achievements-progress-bar"
              style="width:0%; height:100%; background:var(--accent-gradient); transition: width 0.5s ease;"></div>
          </div>
        </div>
        <div id="achievements-grid-container"></div>
      </div>
    </div>

    <!-- VIEW 4: TOOLS -->
    <div id="view-tools" class="view-section">
      <div class="card">
        <h2><span class="icon"><i class="ri-cup-fill"></i></span> Personal Records</h2>
        <div id="pr-section">
          <ul id="pr-list"></ul>
        </div>
      </div>
      <div class="card">
        <h2><span class="icon"><i class="ri-calculator-fill"></i></span> 1RM Calculator</h2>
        <div class="calculator-grid">
          <input type="text" id="calc-exercise" placeholder="Exercise Name (Optional)" />
          <div class="calc-inputs">
            <input type="number" id="calc-weight" placeholder="Weight (kg)" />
            <input type="number" id="calc-reps" placeholder="Reps" />
          </div>
          <button id="btn-calculate-1rm">Calculate Max</button>
        </div>
        <div id="calc-results-area" class="hidden">
          <div class="main-result"><span>Estimated 1-Rep Max:</span><strong id="calc-max-display">0 kg</strong></div>
          <table class="percentage-table">
            <thead>
              <tr>
                <th>% of Max</th>
                <th>Weight</th>
                <th>Reps (Est.)</th>
              </tr>
            </thead>
            <tbody id="percentage-list"></tbody>
          </table>
        </div>
      </div>

      <!-- BMI Calculator -->
      <div class="card">
        <div class="card-header-flex">
          <h2><span class="icon"><i class="ri-scales-fill"></i></span> BMI Calculator</h2>
          <button id="btn-bmi-refresh" class="refresh-btn" title="Reset Calculator"><i
              class="ri-restart-line"></i></button>
        </div>
        <div class="calculator-grid">

          <!-- Height Unit Toggle -->
          <div class="unit-toggle-container">
            <div class="unit-toggle-group">
              <label class="unit-radio-label">
                <input type="radio" name="bmi-height-unit" value="cm" checked> CM
              </label>
              <label class="unit-radio-label">
                <input type="radio" name="bmi-height-unit" value="ft"> FT
              </label>
            </div>
          </div>

          <!-- Height Inputs -->
          <div id="bmi-height-cm-wrapper" class="calc-input-wrapper">
            <input type="number" id="bmi-height" placeholder="Height (cm)" style="width: 100%;" />
          </div>
          <div id="bmi-height-ft-wrapper" class="bmi-inputs-row hidden">
            <input type="number" id="bmi-height-ft" placeholder="Feet" />
            <input type="number" id="bmi-height-in" placeholder="Inches" />
          </div>

          <div class="calc-inputs">
            <input type="number" id="bmi-weight" placeholder="Weight (kg)" style="width: 100%;" />
          </div>
          <button id="btn-calculate-bmi" style="margin-top: 1rem;">Calculate BMI</button>
        </div>
        <div id="bmi-results-area" class="hidden" style="margin-top: 1rem; text-align: center;">
          <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Your BMI: <strong id="bmi-value">--</strong></div>
          <div id="bmi-category" style="font-weight: 600; color: var(--accent-end);">--</div>
        </div>
      </div>

      <!-- Body Fat Calculator -->
      <div class="card">
        <div class="card-header-flex">
          <h2><span class="icon"><i class="ri-body-scan-fill"></i></span> Body Fat % (Navy Method)</h2>
          <button id="btn-bf-info" class="refresh-btn" title="Information"><i class="ri-information-line"></i></button>
        </div>
        <div class="calculator-grid" style="gap: 2rem;">
          <!-- Unit Toggle -->
          <div class="unit-toggle-container">
            <div class="unit-toggle-group">
              <label class="unit-radio-label">
                <input type="radio" name="bf-height-unit" value="cm" checked> CM
              </label>
              <label class="unit-radio-label">
                <input type="radio" name="bf-height-unit" value="ft"> FT
              </label>
            </div>
          </div>

          <div class="calc-inputs">
            <select id="bf-gender"
              style="padding: 0.8rem; border-radius: 8px; border: 1px solid var(--card-border); background: var(--input-bg); color: var(--text);">
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>

          <div class="calc-inputs">
            <!-- CM Input -->
            <div id="bf-height-cm-wrapper" style="width: 100%;">
              <input type="number" id="bf-height" placeholder="Height (cm)" />
            </div>

            <!-- FT/IN Input -->
            <div id="bf-height-ft-wrapper" class="bmi-inputs-row hidden" style="width: 100%;">
              <input type="number" id="bf-height-ft" placeholder="Feet" />
              <input type="number" id="bf-height-in" placeholder="Inches" />
            </div>
          </div>
          <div class="calc-inputs" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
            <input type="number" id="bf-waist" placeholder="Waist (cm)" />
            <input type="number" id="bf-neck" placeholder="Neck (cm)" />
          </div>
          <div class="calc-inputs hidden" id="bf-female-inputs">
            <input type="number" id="bf-hip" placeholder="Hip (cm)" style="width: 100%;" />
          </div>
          <button id="btn-calculate-bf">Calculate Body Fat %</button>
        </div>
        <div id="bf-results-area" class="hidden" style="margin-top: 1rem; text-align: center;">
          <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Body Fat: <strong id="bf-value">--</strong></div>
          <div id="bf-category" style="font-weight: 600; color: var(--accent-end);">--</div>
        </div>
      </div>

      <!-- Muscle Heatmap Card -->
      <div class="card card-wide">
        <h2><span class="icon"><i class="ri-body-scan-line"></i></span> Muscle Heatmap (Last 7 Days)</h2>
        <div class="heatmap-container">
          <div class="heatmap-body front">
            <div class="muscle-label-top">FRONT</div>
            <!-- Head/Neck -->
            <div class="body-part head"></div>
            <div class="body-part neck"></div>

            <!-- Torso -->
            <div class="body-part trap-left" data-muscle="Traps"></div>
            <div class="body-part trap-right" data-muscle="Traps"></div>
            <div class="body-part chest-left" data-muscle="Chest"></div>
            <div class="body-part chest-right" data-muscle="Chest"></div>
            <div class="body-part abs" data-muscle="Abs"></div>
            <div class="body-part oblique-left" data-muscle="Obliques"></div>
            <div class="body-part oblique-right" data-muscle="Obliques"></div>

            <!-- Arms -->
            <div class="body-part delt-front-left" data-muscle="Shoulder"></div>
            <div class="body-part delt-front-right" data-muscle="Shoulder"></div>
            <div class="body-part bicep-left" data-muscle="Bicep"></div>
            <div class="body-part bicep-right" data-muscle="Bicep"></div>
            <div class="body-part forearm-front-left" data-muscle="Forearms"></div>
            <div class="body-part forearm-front-right" data-muscle="Forearms"></div>

            <!-- Legs -->
            <div class="body-part quad-left" data-muscle="Quads"></div>
            <div class="body-part quad-right" data-muscle="Quads"></div>
            <div class="body-part calf-front-left" data-muscle="Calves"></div>
            <div class="body-part calf-front-right" data-muscle="Calves"></div>
          </div>

          <div class="heatmap-body back">
            <div class="muscle-label-top">BACK</div>
            <!-- Head/Neck -->
            <div class="body-part head"></div>
            <div class="body-part neck"></div>

            <!-- Torso -->
            <div class="body-part trap-back-left" data-muscle="Traps"></div>
            <div class="body-part trap-back-right" data-muscle="Traps"></div>
            <div class="body-part lats-left" data-muscle="Lats"></div>
            <div class="body-part lats-right" data-muscle="Lats"></div>
            <div class="body-part lower-back" data-muscle="LowerBack"></div>

            <!-- Arms -->
            <div class="body-part delt-rear-left" data-muscle="Shoulder"></div>
            <div class="body-part delt-rear-right" data-muscle="Shoulder"></div>
            <div class="body-part tricep-left" data-muscle="Tricep"></div>
            <div class="body-part tricep-right" data-muscle="Tricep"></div>
            <div class="body-part forearm-back-left" data-muscle="Forearms"></div>
            <div class="body-part forearm-back-right" data-muscle="Forearms"></div>

            <!-- Legs -->
            <div class="body-part glute-left" data-muscle="Glutes"></div>
            <div class="body-part glute-right" data-muscle="Glutes"></div>
            <div class="body-part hamstring-left" data-muscle="Hamstrings"></div>
            <div class="body-part hamstring-right" data-muscle="Hamstrings"></div>
            <div class="body-part calf-back-left" data-muscle="Calves"></div>
            <div class="body-part calf-back-right" data-muscle="Calves"></div>
          </div>
        </div>
        <div class="heatmap-legend">
          <div class="legend-item"><span class="dot" style="background:var(--input-bg)"></span> Idle</div>
          <div class="legend-item"><span class="dot" style="background:var(--accent-start); opacity:0.5;"></span> Active
          </div>
          <div class="legend-item"><span class="dot"
              style="background:var(--accent-end); box-shadow:0 0 10px var(--accent-end);"></span> Intense</div>
        </div>
      </div>
    </div>

    <!-- VIEW 5: SETTINGS -->
    <div id="view-settings" class="view-section">
      <div class="card">
        <h2><span class="icon"><i class="ri-database-2-fill"></i></span> Data Management</h2>
        <div class="data-info"><strong>Data Status:</strong> <span id="data-status">Loading...</span></div>
        <div class="button-row"><button id="export-btn"><span class="icon-btn"><i class="ri-download-2-fill"></i></span>
            Export</button><button id="import-btn"><span class="icon-btn"><i class="ri-upload-2-fill"></i></span>
            Import</button></div>
        <button id="clear-btn"><span class="icon-btn"><i class="ri-delete-bin-fill"></i></span> Clear All Data</button>
        <button id="logout-btn" style="background-color: var(--text-light); margin-top: 1rem;"><span class="icon-btn"><i
              class="ri-logout-box-r-line"></i></span> Logout</button>
        <input type="file" id="import-input" accept=".json" class="hidden" />
      </div>
      <div class="card">
        <h2><span class="icon"><i class="ri-equalizer-fill"></i></span> App Preferences</h2>

        <div class="setting-item">
          <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
            <label class="setting-label" style="margin:0;">Dark Mode</label>
            <div class="switch"><input type="checkbox" id="theme-toggle" /><label for="theme-toggle"
                class="toggle-switch"></label></div>
          </div>
          <p style="font-size:0.8rem; color:var(--text-light); margin-top:0.3rem;">Switch between light and dark themes.
          </p>
        </div>

        <div class="setting-item">
          <label class="setting-label">Font Style</label>
          <div class="segmented-control">
            <button class="segment-btn active" data-font="modern">Modern</button>
            <button class="segment-btn" data-font="tech">Tech</button>
            <button class="segment-btn" data-font="classic">Classic</button>
          </div>
        </div>

        <div class="setting-item">
          <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
            <label class="setting-label" style="margin:0;">Compact Mode</label>
            <div class="switch"><input type="checkbox" id="compact-toggle" /><label for="compact-toggle"
                class="form-switch"></label></div>
          </div>
          <p style="font-size:0.8rem; color:var(--text-light); margin-top:0.3rem;">Denser layout, more data.</p>
        </div>

        <div class="setting-item">
          <div style="display:flex; justify-content:space-between; align-items:center; width:100%;">
            <label class="setting-label" style="margin:0;">Units</label>
            <div class="unit-toggle-wrapper">
              <span id="unit-label-kg" class="unit-label active">KG</span>
              <div class="switch"><input type="checkbox" id="unit-toggle" /><label for="unit-toggle"
                  class="form-switch"></label></div>
              <span id="unit-label-lbs" class="unit-label">LBS</span>
            </div>
          </div>
          <p style="font-size:0.8rem; color:var(--text-light); margin-top:0.3rem;">Display weights in Pounds.</p>
        </div>

        <div class="setting-item">
          <label class="setting-label">Header Avatar</label>
          <div style="display:flex; gap:1rem; align-items:center; flex-wrap:wrap;">
            <img id="avatar-preview-settings"
              src="https://i.pinimg.com/736x/da/90/9a/da909a8e5bbacd83c82222006ebf7321.jpg"
              style="width:50px; height:50px; border-radius:50%; object-fit:cover; border:2px solid var(--accent-start);">
            <input type="file" id="avatar-upload" accept="image/*" class="hidden">
            <button id="btn-upload-avatar" style="width:auto; padding:0.5rem 1rem; font-size:0.85rem;">Upload
              Photo</button>
            <button id="btn-emoji-avatar"
              style="width:auto; padding:0.5rem 1rem; font-size:0.85rem; background:var(--input-bg); color:var(--text); box-shadow:none;">Use
              Emoji</button>
          </div>
        </div>

      </div>
      <div class="card">
        <h2><span class="icon"><i class="ri-palette-fill"></i></span> Theme Customization</h2>
        <p style="color:var(--text-light); margin-bottom:1rem; font-size:0.9rem;">Select an accent theme for your app:
        </p>
        <div id="theme-grid" class="theme-grid">
          <!-- Themes injected by JS -->
        </div>
      </div>
      <div class="card card-wide">
        <h2><span class="icon"><i class="ri-pie-chart-2-fill"></i></span> Analytics</h2>
        <div class="dropdown-wrapper"><label for="analytics-exercise-select">Filter by Exercise:</label><select
            id="analytics-exercise-select">
            <option value="All">All Exercises</option>
          </select></div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-number" id="total-workouts">0</div>
            <div class="stat-label">Total Workouts</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-volume">0</div>
            <div class="stat-label">Total Volume (kg)</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="total-time">0m</div>
            <div class="stat-label">Total Time</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="avg-session">0m</div>
            <div class="stat-label">Avg Session</div>
          </div>
          <div class="stat-card stat-card-full">
            <div class="stat-number" id="calories-burned">0</div>
            <div class="stat-label"><i class="ri-fire-fill"></i> Est. Calories Burned</div>
          </div>
        </div>

        <div class="chart-tabs">
          <button class="chart-tab active" data-chart="weight">Weight Progress</button>
          <button class="chart-tab" data-chart="volume">Volume</button>
          <button class="chart-tab" data-chart="duration">Duration</button>
          <button class="chart-tab" data-chart="exercises">Distribution</button>
          <button class="chart-tab" data-chart="bodyweight">Body Weight</button>
        </div>

        <div class="chart-container"><canvas id="analyticsChart"></canvas></div>
      </div>

    </div>

  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="bottom-nav">
    <div class="nav-item active" data-target="view-home">
      <span class="icon"><i class="ri-home-4-line"></i></span>
      <span class="label">Home</span>
    </div>
    <div class="nav-item" data-target="view-ai">
      <span class="icon"><i class="ri-robot-2-fill"></i></span>
      <span class="label">AI Assistant</span>
    </div>
    <div class="nav-item" data-target="view-history">
      <span class="icon"><i class="ri-calendar-todo-line"></i></span>
      <span class="label">History</span>
    </div>
    <div class="nav-item" data-target="view-achievements">
      <span class="icon"><i class="ri-trophy-line"></i></span>
      <span class="label">Awards</span>
    </div>
    <div class="nav-item" data-target="view-tools">
      <span class="icon"><i class="ri-tools-line"></i></span>
      <span class="label">Tools</span>
    </div>
    <div class="nav-item" data-target="view-settings">
      <span class="icon"><i class="ri-settings-4-line"></i></span>
      <span class="label">Settings</span>
    </div>
  </nav>

  <!-- Timer -->
  <div id="timer-widget" class="timer-widget">
    <div id="timer-display" class="hidden">00:00</div>
    <div id="timer-controls">
      <button class="timer-btn" data-time="30">30s</button>
      <button class="timer-btn" data-time="60">60s</button>
      <button class="timer-btn" data-time="90">90s</button>
      <button id="timer-cancel" class="timer-btn-cancel hidden">‚ùå</button>
    </div>
    <button id="timer-toggle-icon">‚è±Ô∏è</button>
  </div>

  <!-- Routines Modal -->
  <div id="modal-routines" class="modal hidden">
    <div class="modal-content">
      <span class="close-modal" id="close-routines-modal">&times;</span>
      <h2>Manage Routines</h2>

      <!-- List View -->
      <div id="routines-list-view">
        <div id="saved-routines-list" style="display:flex; flex-direction:column; gap:0.5rem; margin-bottom:1.5rem;">
        </div>
        <button id="btn-new-routine"
          style="background:var(--input-bg); color:var(--text); border:1px dashed var(--accent-start); box-shadow:none;">+
          Create New Routine</button>
      </div>

      <!-- Create View -->
      <div id="create-routine-view" class="hidden">
        <h3 id="create-routine-title"
          style="text-align:left; margin:0 0 1rem 0; font-size:1rem; color:var(--accent-end);">Create Routine</h3>
        <input type="text" id="new-routine-name" placeholder="Routine Name (e.g. Leg Day)" style="margin-bottom:1rem;">
        <p style="font-size:0.85rem; font-weight:700; color:var(--text-light); margin-bottom:0.5rem;">Select
          Exercises:
        </p>
        <div id="exercise-selection-list" class="selection-grid"
          style="max-height:300px; overflow-y:auto; margin-bottom:1rem; border:1px solid var(--card-border); padding:0.5rem; border-radius:12px;">
        </div>
        <button id="btn-save-routine">Save Routine</button>
        <button id="btn-cancel-create"
          style="background:transparent; color:var(--text-light); box-shadow:none; margin-top:0.5rem;">Cancel</button>
      </div>
    </div>
  </div>

  </div>

  <!-- Medal Modal -->
  <div id="modal-medal" class="modal hidden" style="z-index:11000;">
    <div class="modal-content" style="text-align:center; max-width:300px;">
      <div id="medal-icon" style="font-size:5rem; margin-bottom:1rem; animation: bounce 2s infinite;">üèÖ</div>
      <h2 id="medal-title" style="color:var(--accent-end); margin-bottom:0.5rem;">New Medal!</h2>
      <p id="medal-desc" style="color:var(--text-light); margin-bottom:1.5rem;">You unlocked a new achievement.</p>
      <button class="btn-primary"
        onclick="document.getElementById('modal-medal').classList.add('hidden')">Awesome!</button>
    </div>
  </div>

  <!-- Body Fat Info Modal -->
  <div id="modal-bf-info" class="modal hidden" style="z-index:11000;">
    <div class="modal-content" style="max-width: 400px;">
      <span class="close-modal" id="close-bf-info">&times;</span>
      <h2 style="color: var(--accent-end); margin-bottom: 1rem;">Navy Method</h2>
      <p style="color: var(--text); line-height: 1.6; margin-bottom: 1.5rem;">
        The U.S. Navy Method is a widely used, tape-measure-based formula for estimating body fat percentage.
        It is valued for its practicality and has a reported accuracy within about 3% to 4% of professional DEXA scans.
      </p>
      <button class="btn-primary" id="btn-close-bf-info-modal">Got it</button>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <script type="module" src="script.js?v=17"></script>
  <script>
    // EMERGENCY FIX: Unregister Service Worker to clear cache issues
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function (registrations) {
        for (let registration of registrations) {
          console.log('Unregistering SW:', registration);
          registration.unregister();
        }
      });
    }
  </script>
</body>

</html>